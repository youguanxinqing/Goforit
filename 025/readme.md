# 知识点

**-cpu** 用来标记测试执行最大 P 数量的列表。用法如下：
```bash
go test -cpu=2,4 ...
```
- 默认情况下测试正确不会有输出，想输出需要加上 `-v`。
- **-cpu** 对应一个列表（如上），表示分别会以 cpu=2、cpu=4 执行测试函数。这里的 cpu 是逻辑 cpu 数，也就是并发模型中 P 的数量。
- 默认情况下，-cpu=计算机 CPU 核心的实际数量。
- 不论是功能测试函数还是性能测试函数，都会按照 -cpu 值的个数重复执行测试函数。

测试函数要求，在标记名称之后（Test, Benchmark...）跟上的单词必须是首字母大写。

**-count** 用来设置重复执行测试函数。对应值必须要 >= 0，默认 = 1。

对于性能测试函数的执行次数，其公式 = -cpu列表长度 * -count 值 * 探索时的次数。

![](/025/png/8dc543c7ac67dca3dae3eebc53067c56.png)

**不应该让测试反复执行成为检测的手段**，而应该在测试中通过伪造 mock 外部环境，来规避掉他们的不确定性。

>单元测试的意思：对单一的功能模块进行边界清晰的测试，并且不掺杂任何对外部环境的检测。

（
性能测试通常需要多次测试，取平均值，以此降低各种差异的影响。一般来说，模拟性能会低于实际性能。
）

1. -parallel 标记的作用是什么？

设置同一个被测代码包中的功能测试函数的最大并发执行数。默认是最大 P 数量，（untime.GOMAXPROCS(0) 获得 ）

默认情况下，同一个被测代码中的多个**功能测试**函数，会串行的被执行。当需要并发执行的时候，需要在功能函数中显示地调用 t.Parallel()。
- 注意：不论 t.Parallel()，同一个功能函数的多次执行对

2. 性能测试函数中的计时器是做什么用的？